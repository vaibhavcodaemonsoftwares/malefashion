!function(o,i){function e(t){i.BaseGateway.call(this,t),i.CheckoutGateway.call(this),o(document.body).on("click","#place_order",this.place_order.bind(this)),this.is_current_page("order_pay")&&o("#order_review").on("submit",this.process_order_pay.bind(this)),this.maybe_hide_gateway()}function t(t){this.elementType="idealBank",this.confirmation_method="confirmIdealPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function n(t){this.elementType="p24Bank",this.confirmation_method="confirmP24Payment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function a(t){this.elementType="iban",e.call(this,t)}function r(t){this.confirmation_method="confirmKlarnaPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function s(t){this.elementType="fpxBank",this.confirmation_method="confirmFpxPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function h(t){e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function p(t){this.elementType="auBankAccount",this.confirmation_method="confirmAuBecsDebitPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function c(t){this.confirmation_method="confirmGrabPayPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function _(t){this.confirmation_method="confirmAfterpayClearpayPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function d(t){this.confirmation_method="confirmBoletoPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}function l(t){this.confirmation_method="confirmOxxoPayment",e.call(this,t),window.addEventListener("hashchange",this.hashChange.bind(this))}(e.prototype=o.extend({},i.BaseGateway.prototype,i.CheckoutGateway.prototype)).initialize=function(){this.mount_button()},e.prototype.elementType=null,e.prototype.is_active=function(){return o("#wc_stripe_local_payment_"+this.gateway_id).data("active")},e.prototype.maybe_hide_gateway=function(){this.is_active()?o(this.container).show():(o(this.container).hide(),this.is_gateway_selected()&&o('li[class*="payment_method_stripe_"]').filter(":visible").eq(0).find('[name="payment_method"]').prop("checked",!0).trigger("click"))},e.prototype.createSource=function(){return new Promise(function(e,t){var i=function(t){t.error?this.submit_error(t.error):(this.payment_token_received=!0,this.set_nonce(t.source.id),this.get_form().submit()),e()}.bind(this);if(null!=this.elementType)if(this.confirmation_method)if(this.confirmation_obj)this.processConfirmation(this.confirmation_obj);else{if(!this.isValidElement())return this.submit_error({code:"empty_element_"+this.params.local_payment_type,message:wc_stripe_messages.empty_element});this.payment_token_received=!0,this.get_form().submit()}else this.stripe.createSource(this.element,this.getSourceArgs()).then(i)["catch"](function(t){this.submit_error(t.message)}.bind(this));else this.payment_token_received=!0,this.get_form().submit()}.bind(this))},e.prototype.place_order=function(t){this.is_gateway_selected()&&(this.payment_token_received||this.is_saved_method_selected()||(t.preventDefault(),this.createSource()))},e.prototype.process_order_pay=function(t){var e;this.is_gateway_selected()&&(t.preventDefault(),(e=this.get_form().serializeArray()).push({name:"_wpnonce",value:this.params.rest_nonce}),e.push({name:"order_id",value:this.params.order_id}),t=window.location.search,this.params.routes.order_pay.match(/\?/)&&(t="&"+t.substr(1)),o.ajax({url:this.params.routes.order_pay+t,method:"POST",dataType:"json",data:o.param(e)}).done(function(t){t.success?window.location.href=t.redirect:this.submit_error(t.message)}.bind(this)).fail(function(t,e,i){this.submit_error(i)}.bind(this)))},e.prototype.show_payment_button=function(){this.show_place_order()},e.prototype.hide_place_order=function(){},e.prototype.show_place_order=function(){i.CheckoutGateway.prototype.show_place_order.apply(this,arguments),this.payment_token_received&&o("#place_order").text(o("#place_order").data("value"))},e.prototype.getSourceArgs=function(){return{type:this.params.local_payment_type,amount:this.get_total_price_cents(),currency:this.get_currency(),owner:{name:this.get_customer_name(this.get_billing_prefix()),email:this.fields.get("billing_email",null)},redirect:{return_url:this.params.return_url}}},e.prototype.updated_checkout=function(){this.mount_button(),this.maybe_hide_gateway()},e.prototype.mount_button=function(){var t="#wc_stripe_local_payment_"+this.gateway_id;o(t).length&&null!=this.elementType&&(o(t).empty(),this.element||(this.element=this.elements.create(this.elementType,this.params.element_params),this.element.on("change",this.handleElementChange.bind(this))),this.elementEmpty=!0,this.element.mount(t))},e.prototype.handleElementChange=function(t){this.elementEmpty=t.empty},e.prototype.load_external_script=function(t){var e=document.createElement("script");e.type="text/javascript",e.src=t,e.onload=function(){this.script_loaded=!0}.bind(this),document.body.appendChild(e)},e.prototype.hashChange=function(t){var e;!this.is_gateway_selected()||(e=window.location.hash.match(/response=(.*)/))&&(history.pushState({},"",window.location.pathname),e=JSON.parse(window.atob(decodeURIComponent(e[1]))),this.processConfirmation(e))},e.prototype.processConfirmation=function(e){this.stripe[this.confirmation_method](e.client_secret,this.get_confirmation_args(e)).then(function(t){if(t.error)return this.confirmation_obj=e,this.payment_token_received=!1,this.submit_error(t.error.message);window.location.href=decodeURI(e.order_received_url)}.bind(this))},e.prototype.get_confirmation_args=function(t){t={payment_method:{billing_details:this.get_billing_details()},return_url:t.return_url};return this.elementType&&(t.payment_method[this.params.local_payment_type]=this.element),t},e.prototype.isValidElement=function(){return!this.element||!this.elementEmpty},e.prototype.delete_order_source=function(){return new Promise(function(e,t){o.ajax({url:this.params.routes.delete_order_source,method:"DELETE",dataType:"json",beforeSend:this.ajax_before_send.bind(this)}).done(function(t){e(t)}.bind(this)).fail(function(){t()}.bind(this))}.bind(this))},e.prototype.update_source=function(i){return new Promise(function(e,t){this.updateSourceXhr&&this.updateSourceXhr.abort(),this.updateSourceXhr=o.ajax({url:this.params.routes.update_source,method:"POST",dataType:"json",data:{_wpnonce:this.params.rest_nonce,updates:i,source_id:this.source.id,client_secret:this.source.client_secret,payment_method:this.gateway_id}}).done(function(t){e(t.source)}.bind(this)).fail(function(){t()})}.bind(this))},h.prototype.updated_checkout=function(){!this.script_loaded&&o(this.container).length&&this.load_external_script(this.params.qr_script),e.prototype.updated_checkout.apply(this,arguments)},h.prototype.hashChange=function(t){var e;!this.is_gateway_selected()||(e=window.location.hash.match(/qrcode=(.*)/))&&(history.pushState({},"",window.location.pathname),this.qrcode=JSON.parse(window.atob(decodeURIComponent(e[1]))),this.get_form().unblock().removeClass("processing").addClass("wechat"),new QRCode("wc_stripe_local_payment_stripe_wechat",{text:this.qrcode.code,width:parseInt(this.params.qr_size),height:parseInt(this.params.qr_size),colorDark:"#424770",colorLight:"#f8fbfd",correctLevel:QRCode.CorrectLevel.H}),o("#wc_stripe_local_payment_stripe_wechat").append('<p class="qrcode-message">'+this.params.qr_message+"</p>"),this.payment_token_received=!0,this.show_place_order())},h.prototype.place_order=function(t){this.qrcode&&this.payment_token_received?(t.preventDefault(),window.location=this.qrcode.redirect):e.prototype.place_order.apply(this,arguments)},a.prototype.getSourceArgs=function(){var t=o.extend({},e.prototype.getSourceArgs.apply(this,arguments),{mandate:{notification_method:"email",interval:this.cart_contains_subscription()||this.is_change_payment_method()?"scheduled":"one_time"}});return"scheduled"===t.mandate.interval&&delete t.amount,t},_.prototype.is_currency_supported=function(){return-1<this.params.currencies.indexOf(this.get_currency())},_.prototype.updated_checkout=function(){this.maybe_hide_gateway(),this.has_gateway_data()&&this.is_currency_supported()&&(this.add_eligibility(this.container,parseFloat(this.get_total_price())),this.elements=this.stripe.elements(this.get_element_options()),this.initialize_messaging())},_.prototype.initialize=function(){this.has_gateway_data()&&this.is_currency_supported()&&(this.add_eligibility(this.container,parseFloat(this.get_total_price())),this.initialize_messaging())},_.prototype.initialize_messaging=function(){this.msgElement=this.elements.create("afterpayClearpayMessage",o.extend({},this.params.msg_options,{amount:this.get_total_price_cents(),currency:this.get_currency()})),this.mount_message()},_.prototype.mount_message=function(t){t&&this.msgElement.update({amount:this.get_total_price_cents(),currency:this.get_currency()}),o('label[for="payment_method_stripe_afterpay"]').find("#wc-stripe-afterpay-msg").length||o('label[for="payment_method_stripe_afterpay"]').append('<div id="wc-stripe-afterpay-msg"></div>'),this.msgElement.mount("#wc-stripe-afterpay-msg")},_.prototype.add_eligibility=function(t,e){i.Afterpay.prototype.add_eligibility.apply(this,arguments),this.is_eligible(e)||o(this.container).find(".wc-stripe-afterpay__offsite").addClass("afterpay-ineligible")},d.prototype.get_confirmation_args=function(t){t=e.prototype.get_confirmation_args.call(this,t);return t.payment_method.boleto={tax_id:this.get_tax_id()},t},d.prototype.createSource=function(){var t=this.get_tax_id();if(!t||!t.match(/^(\w{3}\.){2}\w{3}-\w{2}$|^(\w{11}|\w{14})$|^\w{2}\.\w{3}\.\w{3}\/\w{4}-\w{2}$/))return this.submit_error({code:"incomplete_boleto_tax_id"});this.payment_token_received=!0,this.get_form().submit()},d.prototype.get_tax_id=function(){return o("#wc_stripe_boleto_tax_id").val()},t.prototype=o.extend({},e.prototype,t.prototype),n.prototype=o.extend({},e.prototype,n.prototype),a.prototype=o.extend({},e.prototype,a.prototype),r.prototype=o.extend({},e.prototype,r.prototype),s.prototype=o.extend({},e.prototype,s.prototype),h.prototype=o.extend({},e.prototype,h.prototype),p.prototype=o.extend({},e.prototype,p.prototype),c.prototype=o.extend({},e.prototype,c.prototype),_.prototype=o.extend({},e.prototype,i.Afterpay.prototype,_.prototype),d.prototype=o.extend({},e.prototype,d.prototype),l.prototype=o.extend({},e.prototype,l.prototype);var m,y={ideal:t,p24:n,sepa_debit:a,klarna:r,fpx:s,wechat:h,au_becs_debit:p,grabpay:c,afterpay_clearpay:_,boleto:d,oxxo:l};for(m in wc_stripe_local_payment_params.gateways){var u=wc_stripe_local_payment_params.gateways[m];new(y[u.local_payment_type]||e)(u)}}(jQuery,window.wc_stripe);